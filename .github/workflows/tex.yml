# -----------------------------------------------------------------------------
#
# Copyright (c) 2017 Sam Cox, Roberto Sommariva
#
# This file is part of the AtChem2 software package.
#
# This file is covered by the MIT license which can be found in the file
# LICENSE.md at the top level of the AtChem2 distribution.
#
# -----------------------------------------------------------------------------

# Workflow for compilation of the AtChem2 manual
# ----------------------------------------------------- #
name: AtChem2 PDF

# ------------------------------ EVENTS ------------------------------ #
# Controls when the workflow is activated
on:

  pull_request:
    branches: [ master ]

  # Triggers when a push is made to the master branch (either by
  # merging a pull request, or by direct commit)
  push:
    branches: [ master ]

# ------------------------------ JOBS ------------------------------ #
# This workflow contains a single job called `pdf_manual`
jobs:
  pdf_manual:
    # The job runs on the latest version of ubuntu linux
    runs-on: ubuntu-latest

    # -------------------------------------------------------------
    # Sequence of tasks to be executed as part of the `ci_testing` job:
    steps:

      # 1. Checkout the repository under $GITHUB_WORKSPACE
      - name: Checkout repo
        uses: actions/checkout@v4

      # 2. Get TeXLive
      - name: Setup LaTeX and install Inkscape
        uses: xu-cheng/texlive-action@v2
        with:
          scheme: full
          run: |
            apk add inkscape

      - name: Compile pdf file
        run: |
          export PATH=$PATH:/opt/texlive/texdir/bin/x86_64-linuxmusl
          echo $PATH 
          which inkscape
          which pdflatex
          which bibtext
          ./tools/make_manual_pdf.sh
          echo "--> doc dir"
          ls doc/
          echo "--> figures dir"
          ls doc/figures
          echo "--> latex dir"
          ls doc/latex


      # - name: Upload PDF as Artifact
      #   uses: actions/upload-artifact@v3
      #   with:
      #     name: AtChem2-Manual.pdf
      #     path: AtChem2-Manual.pdf
