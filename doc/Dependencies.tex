\section{Dependencies} \label{sec:dependencies}

AtChem2 has a number of dependencies (external tools and libraries):
some are required and without them the model cannot be installed or
used, others are optional. We suggest to use a single directory for all
the dependencies; the \emph{dependencies directory} can be located
anywhere and called as you prefer. In the documentation, we will assume
that the \emph{dependencies directory} is
\texttt{\$HOME/atchem-libraries/}.

Before installing the dependencies, make sure that Fortran, Python,
cmake and (optionally) Ruby are installed on your system, as explained
in the {[}{[}installation page\textbar{}1. Installation{]}{]}.

\hypertarget{required-dependencies}{%
\subsection{Required dependencies}\label{required-dependencies}}

\hypertarget{blas-and-lapack}{%
\subsubsection{BLAS and LAPACK}\label{blas-and-lapack}}

BLAS and LAPACK are standard Fortran libraries for linear algebra. They
are needed to install and compile the CVODE library (see below).
Usually, they are in \texttt{/usr/lib/} (e.g.,
\texttt{/usr/lib/libblas/} and \texttt{/usr/lib/lapack/}). The location
may be different, especially if you are on an HPC system, so check the
local documentation or ask the system administrator.

\hypertarget{cvode}{%
\subsubsection{CVODE}\label{cvode}}

AtChem2 uses the CVODE library, which is part of the
\href{https://computation.llnl.gov/projects/sundials}{SUNDIALS} suite,
to solve the system of ordinary differential equation (ODE). The current
version of CVODE is 2.9.0 (part of SUNDIALS 2.7.0) and can be installed
using the \texttt{install\_cvode.sh} script in the
\texttt{tools/install/} directory.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Move to the \emph{AtChem2 main directory} (e.g.,
  \texttt{cd\ \textasciitilde{}/AtChem2}).
\item
  Open the installation script
  (\texttt{tools/install/install\_cvode.sh}) with a text editor:

  \begin{enumerate}
  \def\labelenumii{\arabic{enumii}.}
    \item
    If LAPACK and BLAS are not in the default location on your system
    (see above), change the \texttt{LAPACK\_LIBS} variable for your
    architecture (Linux or macOS), as appropriate.
  \item
    If you are not using the \texttt{gcc} compiler (\texttt{gfortran} is
    part of \texttt{gcc}), change the line
    \texttt{-DCMAKE\_C\_COMPILER:FILEPATH=gcc\ \textbackslash{}}
    accordingly.
  \end{enumerate}
\item
  From the \emph{AtChem2 main directory}, run the installation script
  (change the path of the \emph{dependencies directory} as needed):
  \texttt{./tools/install/install\_cvode.sh\ \textasciitilde{}/atchem-libraries/}
\end{enumerate}

If the installation is successful, there should be a working CVODE
installation at \texttt{\textasciitilde{}/atchem-libraries/cvode/}. The
path to the CVODE library is
\texttt{\textasciitilde{}/atchem-libraries/cvode/lib/}.

\hypertarget{openlibm}{%
\subsubsection{openlibm}\label{openlibm}}

openlibm is a \href{http://openlibm.org/}{portable version} of the
\href{https://en.wikipedia.org/wiki/C_mathematical_functions}{libm}
library. Installing this library and linking against it allows
reproducible results by ensuring the same implementation of several
mathematical functions across platforms.

The current version of openlibm is 0.4.1 and can be installed using the
\texttt{install\_openlibm.sh} script in the \texttt{tools/install/}
directory.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Move to the \emph{AtChem2 main directory} (e.g.,
  \texttt{cd\ \textasciitilde{}/AtChem2}).
\item
  Run the installation script (change the path of the \emph{dependencies
  directory} as needed):
  \texttt{./tools/install/install\_openlibm.sh\ \textasciitilde{}/atchem-libraries/}
\end{enumerate}

If the installation is successful, there should be a working openlibm
installation at
\texttt{\textasciitilde{}/atchem-libraries/openlibm-0.4.1/}.

\hypertarget{optional-dependencies}{%
\subsection{Optional dependencies}\label{optional-dependencies}}

\hypertarget{numdiff}{%
\subsubsection{numdiff}\label{numdiff}}

numdiff is a \href{https://www.nongnu.org/numdiff/}{program} used to
compare files containing numerical fields. It is needed only if you want
to run the {[}{[}Test Suite\textbar{}3.1 Test Suite{]}{]}, a series of
tests to ensure that the model works properly. Installation of numdiff
is recommended if you want to contribute to the development of AtChem2.

Use \texttt{which\ numdiff} to check if the program is already installed
on your system. If not, you can install it locally, for example in the
\emph{dependencies directory}. Use the script
\texttt{install\_numdiff.sh} in the \texttt{tools/install/} directory.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Move to the \emph{AtChem2 main directory} (e.g.,
  \texttt{cd\ \textasciitilde{}/AtChem2}).
\item
  Run the installation script (change the path of the \emph{dependencies
  directory} as needed):
  \texttt{./tools/install/install\_numdiff.sh\ \textasciitilde{}/atchem-libraries/numdiff/}
\item
  Move to your \texttt{\$HOME} directory
  (\texttt{cd\ \textasciitilde{}}). Open the \texttt{.bash\_profile}
  file (or the \texttt{.profile} file, depending on your configuration)
  with a text editor. Add the following line at the bottom of the file
  (change the path of the \emph{dependencies directory} as needed):
  \texttt{PATH=\$PATH:\$HOME/atchem-libraries/numdiff/bin}
\item
  Close the terminal.
\item
  Open the terminal and execute \texttt{which\ numdiff} to check that
  the program has been installed correctly.
\end{enumerate}

\hypertarget{fruit}{%
\subsubsection{FRUIT}\label{fruit}}

FRUIT (FORTRAN Unit Test Framework) is a
\href{https://en.wikipedia.org/wiki/Unit_testing}{unit test framework}
for Fortran. It requires Ruby 2.0 and is needed only if you want to run
the unit tests in the {[}{[}Test Suite\textbar{}3.1 Test Suite{]}{]}.
Installation of FRUIT is recommended if you want to contribute to the
development of AtChem2.

The current version of FRUIT is 3.4.3 and can be installed using the
\texttt{install\_fruit.sh} script in the \texttt{tools/install/}
directory.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Move to the \emph{AtChem2 main directory} (e.g.,
  \texttt{cd\ \textasciitilde{}/AtChem2}).
\item
  Run the installation script (change the path of the \emph{dependencies
  directory} as needed):
  \texttt{./tools/install/install\_fruit.sh\ \textasciitilde{}/atchem-libraries/}
\end{enumerate}

If the installation is successful, there should be a working FRUIT
installation at
\texttt{\textasciitilde{}/atchem-libraries/fruit\_3.4.3/}.
